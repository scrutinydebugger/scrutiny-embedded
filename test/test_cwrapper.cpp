#include "scrutiny_cwrapper.h"
#include "scrutiny_test.hpp"
#include "scrutinytest/scrutinytest.hpp"

class TestCWrapper : public ScrutinyTest
{
};

#ifdef SCRUTINY_CWRAPPER_EXTRACT_CPP_CONSTANTS

TEST_F(TestCWrapper, TestExtractSymbols)
{
    // Make sure the constants extracted with symdump amtches what the C++ compiler embedded in the cwrapper .o
#define _TEMP_SCRUTINY_C_MAIN_HANDLER_SIZE SCRUTINY_C_MAIN_HANDLER_SIZE
#define _TEMP_SCRUTINY_C_CONFIG_SIZE SCRUTINY_C_CONFIG_SIZE
#define _TEMP_SCRUTINY_C_LOOP_HANDLER_FF_SIZE SCRUTINY_C_LOOP_HANDLER_FF_SIZE
#define _TEMP_SCRUTINY_C_LOOP_HANDLER_VF_SIZE SCRUTINY_C_LOOP_HANDLER_VF_SIZE

#undef SCRUTINY_C_MAIN_HANDLER_SIZE
#undef SCRUTINY_C_CONFIG_SIZE
#undef SCRUTINY_C_LOOP_HANDLER_FF_SIZE
#undef SCRUTINY_C_LOOP_HANDLER_VF_SIZE

    extern size_t const SCRUTINY_C_MAIN_HANDLER_SIZE;
    extern size_t const SCRUTINY_C_CONFIG_SIZE;
    extern size_t const SCRUTINY_C_LOOP_HANDLER_FF_SIZE;
    extern size_t const SCRUTINY_C_LOOP_HANDLER_VF_SIZE;

    EXPECT_EQ(SCRUTINY_C_MAIN_HANDLER_SIZE, _TEMP_SCRUTINY_C_MAIN_HANDLER_SIZE);
    EXPECT_EQ(SCRUTINY_C_CONFIG_SIZE, _TEMP_SCRUTINY_C_CONFIG_SIZE);
    EXPECT_EQ(SCRUTINY_C_LOOP_HANDLER_FF_SIZE, _TEMP_SCRUTINY_C_LOOP_HANDLER_FF_SIZE);
    EXPECT_EQ(SCRUTINY_C_LOOP_HANDLER_VF_SIZE, _TEMP_SCRUTINY_C_LOOP_HANDLER_VF_SIZE);

#define SCRUTINY_C_MAIN_HANDLER_SIZE _TEMP_SCRUTINY_C_MAIN_HANDLER_SIZE
#define SCRUTINY_C_CONFIG_SIZE _TEMP_SCRUTINY_C_CONFIG_SIZE
#define SCRUTINY_C_LOOP_HANDLER_FF_SIZE _TEMP_SCRUTINY_C_LOOP_HANDLER_FF_SIZE
#define SCRUTINY_C_LOOP_HANDLER_VF_SIZE _TEMP_SCRUTINY_C_LOOP_HANDLER_VF_SIZE
}
#endif